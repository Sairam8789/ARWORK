<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Babylon.js Web & AR Scene</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #renderCanvas {
        width: 100%;
        height: 100%;
      }
      #arButtonContainer {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 1;
        /* Initially, hide the button container */
        display: none;
      }
      #arButton {
        background-color: #0078d4;
        color: #fff;
        font-size: 16px;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <div id="arButtonContainer">
      <button id="arButton">Open AR</button>
    </div>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", async () => {
        const canvas = document.getElementById("renderCanvas");
        const arButton = document.getElementById("arButton");
        const arButtonContainer = document.getElementById("arButtonContainer");
        const engine = new BABYLON.Engine(canvas, true);
        let scene; // The Babylon.js scene
        let box; // The 3D box in the web mode

        // Function to switch to AR mode
        async function switchToARMode() {
          // Check if AR is supported by the device
          if (BABYLON.ARHelper && (await BABYLON.ARHelper.IsARSupported())) {
            // Hide the AR button container
            arButtonContainer.style.display = "none";

            // Initialize AR session
            const arOptions = {
              // AR-specific options here (e.g., enabling/disabling features)
            };
            await BABYLON.ARHelper.InitAR(scene, arOptions);

            // Create a new AR box at the user's touch position
            scene.onPointerDown = (evt, pickResult) => {
              if (pickResult.hit) {
                const arBox = BABYLON.MeshBuilder.CreateBox(
                  "arBox",
                  { size: 1 },
                  scene
                );
                arBox.position = pickResult.pickedPoint;
              }
            };

            // Switch the active camera to ARCamera
            scene.activeCamera = scene.getCameraByName("arCamera");
          } else {
            // AR not supported on this device or ARHelper is not available
            console.log(
              "AR not supported on this device or ARHelper is not available."
            );
          }
        }

        // Create the initial web scene
        function createWebScene() {
          scene = new BABYLON.Scene(engine);

          // Create an ArcRotateCamera and position it around the scene
          const camera = new BABYLON.ArcRotateCamera(
            "camera",
            -Math.PI / 2,
            Math.PI / 4,
            5,
            new BABYLON.Vector3(0, 1, 0),
            scene
          );

          // Set target to look at the origin
          camera.setTarget(BABYLON.Vector3.Zero());

          // Attach camera controls to the canvas
          camera.attachControl(canvas, true);

          // Create a light and position it
          const light = new BABYLON.HemisphericLight(
            "light",
            new BABYLON.Vector3(0, 1, 0),
            scene
          );

          // Create a box and position it
          box = BABYLON.MeshBuilder.CreateBox("box", { size: 1 }, scene);

          // Animation to rotate the box
          const animation = new BABYLON.Animation(
            "boxAnimation",
            "rotation.y",
            30,
            BABYLON.Animation.ANIMATIONTYPE_FLOAT,
            BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE
          );
          const keys = [
            { frame: 0, value: 0 },
            { frame: 100, value: Math.PI * 2 },
          ];
          animation.setKeys(keys);
          box.animations = [animation];
          scene.beginAnimation(box, 0, 100, true);

          // Render loop
          engine.runRenderLoop(() => {
            scene.render();
          });

          // Handle window resizing
          window.addEventListener("resize", () => {
            engine.resize();
          });

          // Show the AR button container when the web scene is loaded
          arButtonContainer.style.display = "block";
        }

        // Event listener for the AR button click
        arButton.addEventListener("click", switchToARMode);

        // Create the initial web scene
        createWebScene();
      });
    </script>
  </body>
</html>
