<!DOCTYPE html>
<html>
<head>
  <title>Babylon.js AR Object Movement</title>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
  <style>
    canvas {
      touch-action: none; /* Disable default touch gestures on canvas */
    }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>

  <script>
    var canvas = document.getElementById("renderCanvas");
    var engine = new BABYLON.Engine(canvas, true);

    function createScene() {
      var scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color3(0.8, 0.8, 0.8);

      // Create an AR camera
      var arCamera = new BABYLON.WebXRCamera("ARCamera", scene, {
        // AR options if supported by the device
      });

      // Enable AR experience and feature points visualization
      scene.createDefaultXRExperienceAsync().then((xr) => {
        xr.pointerSelection.enableTeleportation({floorMeshName: 'ground'});

        // Create a 3D object (e.g., a box) to move in AR
        var box = BABYLON.MeshBuilder.CreateBox("box", { size: 0.2 }, scene);
        box.position.y = 0.1;

        // Handle user interaction to move the box
        var isMoving = false;
        var startPos = new BABYLON.Vector3();

        xr.pointerSelection.onSelectObservable.add(() => {
          if (xr.pointerSelection.currentMesh === box) {
            isMoving = true;
            startPos.copyFrom(box.position);
          }
        });

        canvas.addEventListener("pointermove", (event) => {
          if (isMoving) {
            var pickResult = scene.pick(event.clientX, event.clientY);
            if (pickResult.hit) {
              box.position.copyFrom(startPos).addInPlace(pickResult.pickedPoint);
            }
          }
        });

        xr.pointerSelection.onEndObservable.add(() => {
          isMoving = false;
        });
      });

      return scene;
    }

    var scene = createScene();

    engine.runRenderLoop(function () {
      scene.render();
    });

    window.addEventListener("resize", function () {
      engine.resize();
    });
  </script>
</body>
</html>
